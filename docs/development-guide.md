# 開発ガイド

新規参画メンバー向けの開発フローとルールをまとめたドキュメントです。

## 目次

1. [開発環境セットアップ](#開発環境セットアップ)
2. [ブランチ戦略](#ブランチ戦略)
3. [コーディング規約](#コーディング規約)
4. [コミットメッセージ規約](#コミットメッセージ規約)
5. [開発フロー](#開発フロー)
6. [PR作成ルール](#pr作成ルール)
7. [関連ドキュメント](#関連ドキュメント)

---

## 開発環境セットアップ

開発環境のセットアップ方法は [README](../README.md#開発環境のセットアップ) を参照してください。

Dev Containerを使用することで、統一された開発環境を簡単に構築できます。

---

## ブランチ戦略

```
main        ← 本番リリース用
  ↑
develop     ← 開発統合ブランチ（PRのマージ先）
  ↑
feature/*   ← 機能開発ブランチ
fix/*       ← バグ修正ブランチ
```

### ブランチの役割

| ブランチ | 役割 |
|---------|------|
| `main` | 本番環境にデプロイされるブランチ |
| `develop` | 開発統合ブランチ、PRのマージ先 |
| `feature/xxx` | 新機能開発用ブランチ |
| `fix/xxx` | バグ修正用ブランチ |

### ブランチ命名例

- `feature/user-authentication` - ユーザー認証機能
- `feature/add-health-check` - ヘルスチェック追加
- `fix/login-validation-error` - ログインバリデーションのバグ修正

---

## コーディング規約

### フォーマット

ESLint + Prettierによる自動フォーマットを採用しています。

```bash
# コードチェック
pnpm lint

# 自動フォーマット
pnpm format
```

### 設定ファイル

| ファイル | 用途 |
|---------|------|
| `.prettierrc` | Prettierの設定 |
| `eslint.config.mjs` | ESLintの設定 |

### コミット前の確認

コミット前に必ず以下を実行してください：

```bash
pnpm lint
pnpm format
```

---

## コミットメッセージ規約

### フォーマット

```
<type>: <説明>
```

### タイプ一覧

| タイプ | 用途 |
|-------|------|
| `feat` | 新機能追加 |
| `fix` | バグ修正 |
| `docs` | ドキュメント変更 |
| `test` | テスト追加・修正 |
| `refactor` | リファクタリング |
| `ci` | CI/CD設定変更 |
| `chore` | その他雑務 |

### 記述ルール

- 日本語での記述OK
- 簡潔かつ具体的に記述

### 例

```
feat: ユーザー認証機能を追加
fix: ログインバリデーションエラーを修正
docs: READMEにセットアップ手順を追加
test: ユーザーサービスのユニットテストを追加
refactor: ユーザーモジュールの構成を整理
ci: GitHub Actionsにテストワークフローを追加
chore: 依存パッケージを更新
```

---

## 開発フロー

1. **Issue確認または作成**
   - 着手する前にIssueを確認、なければ作成

2. **ブランチ作成**
   - `develop`ブランチから`feature/xxx`または`fix/xxx`ブランチを作成
   ```bash
   git checkout develop
   git pull origin develop
   git checkout -b feature/xxx
   ```

3. **実装**
   - コーディング規約に従って実装

4. **テスト実行**
   ```bash
   pnpm test
   ```

5. **リント・フォーマット実行**
   ```bash
   pnpm lint
   pnpm format
   ```

6. **コミット & プッシュ**
   ```bash
   git add .
   git commit -m "feat: 機能の説明"
   git push origin feature/xxx
   ```

7. **PR作成**
   - `develop`ブランチへのPRを作成
   - PRテンプレートに従って記述

8. **CIパス確認 + レビュー**
   - CIが全てパスすることを確認
   - 1名以上のレビュー承認を取得

9. **マージ**
   - コンフリクトがあれば解消後マージ

---

## PR作成ルール

### 必須要件

- PRテンプレートに従って記述すること
- 以下のCIチェックが全てパスすること
  - lint
  - test
  - build
- 1名以上のレビュー承認を取得すること
- マージ前にコンフリクトを解消すること

### PRテンプレート

PRを作成すると自動的にテンプレートが適用されます。テンプレートに沿って必要事項を記入してください。

---

## 関連ドキュメント

- [テストガイドライン](testing-guidelines.md)
- [エラーハンドリング](error-handling.md)
- [認証](authentication.md)
- [ロギング](logging.md)
- [ヘルスチェック](health-check.md)
